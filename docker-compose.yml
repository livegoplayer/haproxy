version: '2'

services:
    haproxy_rabbitmq:
      build: ./
      container_name: haproxy_rabbitmq
      ports:
         - "5670:5670"
         - "8000:8000"
      network_mode: host
      volumes:
        #workdir
        - ../:/apps
        #配置日志文件的一部分，剩下的在start.sh内
        - ./conf/syslog/syslog.conf:/etc/rsyslog.d/syslog.conf
        - ../logs:/var/log

        # 持久化目录
        - ./data/haproxy:/usr/local/etc/haproxy:ro

        #consul-template
        - ./consul-template:/consul-template
        - ./consul-template/consul-template:/usr/local/bin/consul-template:ro

        #sh 目录
        - ./sh:/sh:ro
        - ./supervisor:/supervisor

      command: /usr/local/bin/supervisord -n -c /supervisor/conf.d/supervisord.conf


